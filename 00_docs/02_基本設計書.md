# 基本設計書

| 項目 | 内容 |
|------|------|
| システム名 | ナレッジ管理システム |
| サブシステム名 | Phase 1: 基本機能 |
| 作成者 | 鴫原 |
| 初版 | 2026/2/25 |
| 改訂 | - |
| 版数 | 1 |

---

## 0. Phase 1スコープ（本書の対象範囲）

本書は、Phase 1（MVP）のスコープのみを対象とします。

| 分類 | 機能項目 | 実施有無 |
|------|----------|----------|
| データ形式 | Markdownインポート | 対象 |
| データ形式 | DOCX / PDF インポート | 対象外 |
| 登録 | ファイルアップロード（手動） | 対象 |
| 登録 | Google Drive連携 | 対象外 |
| 一覧・検索 | 一覧表示・キーワード・タグ・カテゴリ検索 | 対象 |
| 閲覧 | Markdownレンダリング・メタ情報表示 | 対象 |
| 関連 | 同タグによる関連ドキュメント表示 | 対象 |
| 関連 | グラフ探索ビュー・概念検索 | 対象外 |
| 管理 | ブックマーク | 対象（必須・簡易実装） |
| 管理 | 閲覧履歴 | 対象（必須・簡易実装） |
| DB | PostgreSQL コンテナ（メタデータ） | 対象 |
| DB | ローカルファイルシステム（本文） | 対象 |
| DB | Neo4j（Dockerコンテナ版） | 対象（taggedリレーションのみ） |
| AI | Claude API（要約・概念抽出） | 対象外 |
| AI | LangGraph Agent | 対象外 |
| 認証 | アクセス制御・権限管理 | 対象外 |

---

## 1. システム構成

### 1.1 WEB3層モデル構成（Phase 1）

本システムは、Docker Composeを用いてWEB3層モデルを実現します。

| 層 | 役割 | 使用技術 |
|----|------|----------|
| プレゼンテーション層 | ユーザーが操作する画面・リクエストの振り分け | HTML / CSS / JavaScript + Nginx |
| アプリケーション層 | 業務ロジック・REST API処理 | FastAPI（Python） |
| データ層 | データの永続化 | PostgreSQL コンテナ + ローカルファイルシステム + Neo4j（Dockerコンテナ版）（taggedリレーションのみ） |

### 1.2 Docker Composeサービス構成

| サービス名 | イメージ | ポート | 役割 |
|-----------|----------|--------|------|
| nginx | nginx:alpine | 80（外部公開） | リバースプロキシ・静的ファイル配信 |
| backend | python:3.11-slim | 8000（内部） | FastAPI バックエンドAPI |
| postgres | postgres:15 | 5432（内部） | メタデータ管理（PostgreSQL コンテナ） |
| neo4j | neo4j:5 | 7474 / 7687（内部） | タグリレーション管理 |

### 1.3 課題用設計書（全Phase）との対応

| 課題用設計書（全Phase） | Phase 1実装 | 備考 |
|------------------------|------------|------|
| Cloudflare Workers | FastAPI コンテナ（Python） | Pythonで統一、学習コスト低 |
| Cloudflare D1 | PostgreSQL コンテナ | 標準的なRDB |
| Cloudflare R2 | ローカルファイルシステム（Dockerボリューム） | 研修環境のため代替 |
| Neo4j AuraDB | Neo4j（Dockerコンテナ版） | taggedリレーションのみ |
| Cloud Run | FastAPI コンテナに統合 | Phase 1では単一バックエンド |
| LangGraph / Claude API | 対象外 | Phase 2以降 |
| Google Drive連携 | 対象外 | Phase 2以降 |
| DOCX / PDF変換 | 対象外 | Phase 2以降 |

---

## 2. 画面設計

### 2.1 画面一覧（Phase 1）

| No. | 画面名 | URL | 概要 |
|-----|--------|-----|------|
| 1 | ドキュメント一覧画面 | / | ドキュメント一覧表示・キーワード／タグ／カテゴリ検索 |
| 2 | ドキュメント詳細画面 | /documents/{id} | Markdownレンダリング・メタ情報・関連ドキュメント表示 |
| 3 | ドキュメント登録画面 | /upload | MDファイルアップロード・タイトル／タグ／カテゴリ入力 |
| 4 | 検索結果画面 | /search | キーワード入力・カテゴリ／タグ絞り込み・検索結果一覧表示 |

### 2.2 画面遷移

- 一覧画面 → ドキュメントをクリック → 詳細画面
- 一覧画面 → 検索条件入力 → 検索結果画面
- 一覧画面 → 「登録」ボタン → 登録画面
- 詳細画面 → 関連ドキュメントをクリック → 詳細画面
- 詳細画面 → 「一覧に戻る」 → 一覧画面
- 登録画面 → 登録完了 → 一覧画面にリダイレクト

---

## 3. データ設計（概要）

### 3.1 データストアの役割分離（Phase 1）

| データストア | 役割 | Phase 1での用途 |
|-------------|------|----------------|
| PostgreSQL コンテナ | メタデータ管理・検索 | ドキュメント情報・タグ・カテゴリ・ブックマーク・閲覧履歴 |
| ローカルファイルシステム（Dockerボリューム） | 本文ファイル保存 | Markdownファイル（/data/documents/ 配下） |
| Neo4j（Dockerコンテナ版） | タグリレーション管理 | DocumentノードとTagノードのtaggedリレーションのみ |

Neo4jのConceptノード・related_to・discussesリレーションはPhase 1対象外。

---
